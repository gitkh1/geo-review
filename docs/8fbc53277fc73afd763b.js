!function(e){var n={};function t(o){if(n[o])return n[o].exports;var a=n[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,t),a.l=!0,a.exports}t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var a in e)t.d(o,a,function(n){return e[n]}.bind(null,a));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=2)}([function(e,n,t){const o=t(1).default;document.write(o)},function(e,n,t){"use strict";t.r(n),n.default='<style>\n  body,\n  html {\n    padding: 0;\n    margin: 0;\n    width: 100%;\n    height: 100%;\n  }\n\n  #app {\n    width: 100%;\n    height: 100%;\n  }\n\n  .reviewForm {\n    display: flex;\n    flex-direction: column;\n  }\n\n  .balloon {\n    font-size: 16px;\n    font-family: Arial;\n  }\n\n  .review {\n    padding: 10px 0;\n  }\n\n  .review--newreview {\n    border-top: 1px solid #E7E7E7;\n  }\n\n  .review__info {\n    display: flex;\n    justify-content: flex-start;\n  }\n\n  .review__name {\n    font-weight: bold;\n    margin-right: 5px;\n  }\n\n  .review__place {\n    color: rgba(143, 143, 143, 1);\n    text-decoration: none;\n    margin-right: 5px;\n  }\n\n  .review__date {\n    color: rgba(143, 143, 143, 1);\n  }\n\n  .review__text {\n    color: rgba(143, 143, 143, 1);\n  }\n\n  .review__title {\n    font-weight: bold;\n  }\n\n  .review__form {\n    margin-top: 20px;\n  }\n\n  .form {\n    font-size: 14px;\n  }\n\n  .form__input {\n    margin-bottom: 10px;\n  }\n\n  .form__input:last-child {\n    margin-bottom: 0;\n  }\n\n  .form__input input,\n  .form__input textarea {\n    color: #000;\n    padding: 9px;\n    box-sizing: border-box;\n    width: 100%;\n    font-family: Arial;\n  }\n\n  .form__submit .button {\n    background-color: #FF8663;\n    color: #fff;\n    font-weight: bold;\n    padding: 9px 16px;\n    cursor: pointer;\n    border: 0;\n    border-radius: 2px;\n    width: auto;\n  }\n\n  .carousel {\n    position: relative;\n    padding: 0 13px;\n    display: flex;\n    overflow: hidden;\n  }\n\n  .carousel__item {\n    display: flex;\n    justify-content: flex-start;\n    flex-direction: column;\n    font-size: 16px;\n  }\n\n  .customBalloon {\n    position: absolute;\n    background: #fff;\n    padding: 10px;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    cursor: pointer;\n  }\n\n  .customBalloon__inner {\n    overflow-y: scroll;\n  }\n\n  .customBalloon__tail {\n    display: block;\n    position: relative;\n    left: 15px;\n    top: 10px;\n    width: 17px;\n    height: 17px;\n    margin-bottom: -17px;\n    -webkit-transform: rotate(-45deg);\n    transform: rotate(-45deg);\n    -webkit-transform-origin: top left;\n    transform-origin: top left;\n  }\n\n  .customBalloon__tail::after {\n    content: \'\';\n    position: absolute;\n    width: 20px;\n    height: 20px;\n    background-color: #fff;\n    bottom: 1px;\n    left: 1px;\n  }\n</style>\n\n<div id="app">\n\n</div>\n\n<template id="customBalloonTemplate">\n  <div class="customBalloon">\n    <div class="balloon customBalloon__inner">\n    </div>\n  </div>\n</template>\n<template id="reviewTemplate">\n  <div class="review">\n    <div class="review__info">\n      <div class="review__name"></div>\n      <a class="review__place carousel__link" data-ymaps-x="" data-ymaps-y="" href="#"></a>\n      <div class="review__date"></div>\n    </div>\n    <div class="review__text"></div>\n  </div>\n</template>\n<template id="reviewFormBalloonContentLayout">\n  <div class="balloon">\n    <div class="review">\n      <div class="review__info">\n        <div class="review__name">{{properties.name}}</div>\n        <div class="review__place">{{properties.place}}</div>\n        <div class="review__date">{{properties.date}}</div>\n      </div>\n      <div class="review__text">{{properties.text}}</div>\n    </div>\n    <div class="review review--newreview">\n      <div class="review__title">Отзыв:</div>\n      <form class="review__form form">\n        <div class="form__input form__name"><input placeholder="Укажите Ваше имя" name="name" /></div>\n        <div class="form__input form__place"><input placeholder="Укажите место" name="place" /></div>\n        <div class="form__input form__text"><textarea rows="5" placeholder="Оставить отзыв" name="text"></textarea>\n        </div>\n        <div class="form__input form__submit"><input type="submit" value="Добавить" class="button" /></div>\n      </form>\n    </div>\n  </div>\n</template>\n<template id="carouselBalloonItemContentLayout">\n  <div class="review carousel__item">\n    <div class="review__info">\n      <div class="review__name">{{geoObject.properties.name}}</div>\n      <a class="review__place carousel__link" data-ymaps-x={{geoObject.properties.x}}\n        data-ymaps-y={{geoObject.properties.y}} href="#">{{geoObject.properties.place}}</a>\n    </div>\n    <div class="review__text">{{geoObject.properties.text}}</div>\n  </div>\n</template>\n<template id="carouselBalloonContentLayout">\n  <div class="balloon">\n    {% include "cluster#balloonCarousel" %}\n    <div class="review review--newreview">\n      <div class="review__title">Отзыв:</div>\n      <form class="review__form form">\n        <div class="form__input form__name"><input placeholder="Укажите Ваше имя" name="name" /></div>\n        <div class="form__input form__place"><input placeholder="Укажите место" name="place" /></div>\n        <div class="form__input form__text"><textarea rows="5" placeholder="Оставить отзыв" name="text"></textarea>\n        </div>\n        <div class="form__input form__submit"><input type="submit" value="Добавить" class="button" /></div>\n      </form>\n    </div>\n  </div>\n</template>'},function(e,n,t){"use strict";t.r(n);t(0);var o={load:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"//api-maps.yandex.ru/2.1/?lang=en_RU",n=function(){var n=e.match(/[\\?&]ns=([^&#]*)/);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))};return this.promise||(this.promise=new Promise((function(n,t){var o=document.createElement("script");o.onload=n,o.onerror=t,o.type="text/javascript",o.src=e,document.body.appendChild(o)})).then((function(){var e=n();return e&&"ymaps"!==e&&(0,eval)("var ymaps = ".concat(e,";")),new Promise((function(e){return ymaps.ready(e)}))}))),this.promise}};const a=document.querySelector("#app");function r(){return JSON.parse(localStorage.getItem("geo"))}function i(){const e=new Date,n="0".concat(e.getDate()).slice(-2),t="0".concat(e.getMonth()+1).slice(-2);return"".concat(n,".").concat(t,".").concat(e.getFullYear())}localStorage.getItem("geo")||localStorage.setItem("geo",JSON.stringify([])),o.load("https://api-maps.yandex.ru/2.1/?apikey=0b1ae83c-cabe-4a13-94d9-9910b90ef315&lang=ru_RU").then((function(e){const n=new e.Map(a,{center:[55.76,37.64],zoom:14}),t=e.templateLayoutFactory.createClass(document.getElementById("reviewFormBalloonContentLayout").content.cloneNode(!0).firstElementChild.outerHTML),o=e.templateLayoutFactory.createClass(document.getElementById("carouselBalloonItemContentLayout").content.cloneNode(!0).firstElementChild.outerHTML),l=e.templateLayoutFactory.createClass(document.getElementById("carouselBalloonContentLayout").content.cloneNode(!0).firstElementChild.outerHTML);function c(n){e.geocode(n).then((function(e){const n=e.geoObjects.get(0);document.title=n.getAddressLine()}))}const s=r(),d=[];for(let n=0,o=s.length;n<o;n++)d[n]=new e.Placemark([s[n].x,s[n].y],{x:s[u=n].x,y:s[u].y,name:s[u].name,place:s[u].place,text:s[u].text,date:s[u].date},{balloonContentLayout:t});var u;const p=new e.Clusterer({clusterBalloonContentLayout:l,clusterBalloonItemContentLayout:o,clusterDisableClickZoom:!0,clusterBalloonPagerVisible:!1,clusterBalloonContentLayoutWidth:150,clusterBalloonContentLayoutHeight:130});p.add(d),n.geoObjects.add(p),n.events.add("click",e=>{if(n.balloon.isOpen())n.balloon.close();else{const o=e.get("coords");c(o),n.balloon.open(o,{coords:o},{contentLayout:t})}}),n.geoObjects.events.add("click",e=>{c(e.get("coords"))}),document.addEventListener("click",o=>{if(o.target.classList.contains("button")){o.preventDefault();const a=n.balloon.getData().geometry?n.balloon.getData().geometry.getCoordinates():n.balloon.getData().coords,l=document.querySelector(".review__form");if(""===l.name.value||""===l.place.value||""===l.text.value)return void alert("Поля формы должны быть заполены!");const c={x:a[0],y:a[1],name:l.name.value,place:l.place.value,text:l.text.value,date:i()};!function(e){const n=r();n.push(e),localStorage.setItem("geo",JSON.stringify(n))}(c);const s=new e.Placemark(a,c,{balloonContentLayout:t});n.geoObjects.add(s),p.add(s),n.balloon.close()}else if(o.target.classList.contains("carousel__link")){const e=function(e,n){const t=[];return r().forEach(o=>{e===o.x&&n===o.y&&t.push(o)}),t}(Number(o.target.getAttribute("data-ymaps-x")),Number(o.target.getAttribute("data-ymaps-y"))),t=document.body.appendChild(function(e){const n=document.getElementById("reviewTemplate"),t=document.getElementById("customBalloonTemplate").content.cloneNode(!0).firstElementChild,o=t.querySelector(".balloon");return e.forEach(e=>{const t=n.content.cloneNode(!0).firstElementChild;t.querySelector(".review__name").textContent=e.name,t.querySelector(".review__place").textContent=e.place,t.querySelector(".review__date").textContent=e.date,t.querySelector(".review__text").textContent=e.text,t.querySelector(".review__place").setAttribute("data-ymaps-x",e.x),t.querySelector(".review__place").setAttribute("data-ymaps-y",e.y),o.appendChild(t)}),t}(e));n.balloon.close(),document.addEventListener("click",e=>document.body.removeChild(t),{once:!0})}})}))}]);